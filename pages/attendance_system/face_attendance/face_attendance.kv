<FaceAttendanceScreen>:
    name: "face_attendance"

    FloatLayout:

        # ===== Header (CONSTANT) =====
        Header:
            pos_hint: {"top": 1}

        # ===== Back Button (PAGE LEVEL – TRANSPARENT) =====
        BoxLayout:
            orientation: "horizontal"
            size_hint_y: None
            height: "48dp"
            padding: "16dp", 0
            pos_hint: {"top": .95}

            Button:
                text: "Back"
                size_hint_x: None
                width: "100dp"
                background_normal: ""
                background_color: 0, 0, 0, 0   # fully transparent
                color: 0.90, 0.95, 1, 1
                font_size: "16sp"
                on_release: root.go_back()

            Widget:
            
            # Mode Toggle Button
            Button:
                text: "Manual" if root.verification_mode else "Auto"
                size_hint_x: None
                width: "100dp"
                background_normal: ""
                background_color: 0.2, 0.5, 0.8, 0.8
                color: 1, 1, 1, 1
                font_size: "14sp"
                on_release: root.toggle_verification_mode()

        # ===== Main Content =====
        BoxLayout:
            orientation: "horizontal"
            spacing: "20dp"
            size_hint: None, None
            size: "760dp", "540dp"
            pos_hint: {"center_x": 0.5, "center_y": 0.52}
            
            # LEFT SIDE: Camera and controls
            BoxLayout:
                orientation: "vertical"
                spacing: "20dp"
                size_hint_x: 0.6

                # ===== Toggle Buttons (In-Time / Out-Time) =====
                BoxLayout:
                    orientation: "horizontal"
                    size_hint_y: None
                    height: "50dp"
                    spacing: "10dp"

                    ToggleButton:
                        id: in_time_btn
                        text: "In-Time"
                        font_size: "18sp"
                        group: "time_type"
                        state: "down"
                        background_normal: ""
                        background_color: 0, 0, 0, 0
                        color: 0.85, 0.95, 1, 1
                        on_release: root.on_time_type_change("in")

                        canvas.before:
                            Color:
                                rgba: (0.15, 0.30, 0.45, 0.95) if self.state == "down" else (0.18, 0.35, 0.50, 0.6)
                            RoundedRectangle:
                                pos: self.pos
                                size: self.size
                                radius: [25]

                    ToggleButton:
                        id: out_time_btn
                        text: "Out-Time"
                        font_size: "18sp"
                        group: "time_type"
                        background_normal: ""
                        background_color: 0, 0, 0, 0
                        color: 0.85, 0.95, 1, 1
                        on_release: root.on_time_type_change("out")

                        canvas.before:
                            Color:
                                rgba: (0.15, 0.30, 0.45, 0.95) if self.state == "down" else (0.18, 0.35, 0.50, 0.6)
                            RoundedRectangle:
                                pos: self.pos
                                size: self.size
                                radius: [25]

                # ===== Camera Feed Display =====
                FloatLayout:
                    size_hint_y: None
                    height: "340dp"

                    canvas.before:
                        Color:
                            rgba: 0.18, 0.35, 0.50, 0.5
                        RoundedRectangle:
                            pos: self.pos
                            size: self.size
                            radius: [20]

                    # Camera widget with rounded corners
                    KivyCamera:
                        id: camera_feed
                        size_hint: None, None
                        size: "440dp", "320dp"
                        pos_hint: {"center_x": 0.5, "center_y": 0.5}

                # ===== Welcome Message =====
                BoxLayout:
                    size_hint_y: None
                    height: "60dp"
                    padding: "10dp", 0

                    canvas.before:
                        Color:
                            rgba: 0.18, 0.35, 0.50, 0.85
                        RoundedRectangle:
                            pos: self.pos
                            size: self.size
                            radius: [30]

                    Label:
                        id: welcome_label
                        text: '"USER_NAME" --> Welcome'
                        font_size: "18sp"
                        color: 0.85, 0.95, 1, 1
                        halign: "center"
                        valign: "middle"
                
                # ===== Status Label =====
                Label:
                    id: status_label
                    text: ""
                    font_size: "14sp"
                    size_hint_y: None
                    height: "30dp"
                    color: 1, 1, 1, 1
                    halign: "center"
                    valign: "middle"
            
            # RIGHT SIDE: Manual Verification Panel (only visible in manual mode)
            BoxLayout:
                orientation: "vertical"
                spacing: "10dp"
                size_hint_x: 0.4
                opacity: 1 if root.verification_mode else 0.3
                disabled: not root.verification_mode

                canvas.before:
                    Color:
                        rgba: 0.15, 0.25, 0.35, 0.9
                    RoundedRectangle:
                        pos: self.pos
                        size: self.size
                        radius: [15]

                # Title
                Label:
                    text: "Manual Verification"
                    font_size: "18sp"
                    bold: True
                    color: 0.9, 0.95, 1, 1
                    size_hint_y: None
                    height: "40dp"

                # Employee Code Input Display
                BoxLayout:
                    orientation: "horizontal"
                    size_hint_y: None
                    height: "50dp"
                    padding: "10dp", 0
                    spacing: "5dp"

                    Label:
                        text: "Code:"
                        font_size: "16sp"
                        color: 0.85, 0.95, 1, 1
                        size_hint_x: 0.25

                    TextInput:
                        id: employee_code_input
                        text: root.employee_code
                        font_size: "20sp"
                        readonly: True
                        multiline: False
                        background_normal: ""
                        background_color: 0.2, 0.3, 0.4, 0.9
                        foreground_color: 1, 1, 1, 1
                        padding: "10dp", "12dp"
                        halign: "center"
                        cursor_color: 1, 1, 1, 1

                # Numeric Keypad
                GridLayout:
                    cols: 3
                    spacing: "8dp"
                    padding: "10dp"
                    size_hint_y: None
                    height: "280dp"

                    # Row 1: 1 2 3
                    Button:
                        text: "1"
                        font_size: "24sp"
                        background_normal: ""
                        background_color: 0.2, 0.4, 0.6, 0.9
                        color: 1, 1, 1, 1
                        on_release: root.on_key_press("1")
                        canvas.before:
                            Color:
                                rgba: self.background_color
                            RoundedRectangle:
                                pos: self.pos
                                size: self.size
                                radius: [10]

                    Button:
                        text: "2"
                        font_size: "24sp"
                        background_normal: ""
                        background_color: 0.2, 0.4, 0.6, 0.9
                        color: 1, 1, 1, 1
                        on_release: root.on_key_press("2")
                        canvas.before:
                            Color:
                                rgba: self.background_color
                            RoundedRectangle:
                                pos: self.pos
                                size: self.size
                                radius: [10]

                    Button:
                        text: "3"
                        font_size: "24sp"
                        background_normal: ""
                        background_color: 0.2, 0.4, 0.6, 0.9
                        color: 1, 1, 1, 1
                        on_release: root.on_key_press("3")
                        canvas.before:
                            Color:
                                rgba: self.background_color
                            RoundedRectangle:
                                pos: self.pos
                                size: self.size
                                radius: [10]

                    # Row 2: 4 5 6
                    Button:
                        text: "4"
                        font_size: "24sp"
                        background_normal: ""
                        background_color: 0.2, 0.4, 0.6, 0.9
                        color: 1, 1, 1, 1
                        on_release: root.on_key_press("4")
                        canvas.before:
                            Color:
                                rgba: self.background_color
                            RoundedRectangle:
                                pos: self.pos
                                size: self.size
                                radius: [10]

                    Button:
                        text: "5"
                        font_size: "24sp"
                        background_normal: ""
                        background_color: 0.2, 0.4, 0.6, 0.9
                        color: 1, 1, 1, 1
                        on_release: root.on_key_press("5")
                        canvas.before:
                            Color:
                                rgba: self.background_color
                            RoundedRectangle:
                                pos: self.pos
                                size: self.size
                                radius: [10]

                    Button:
                        text: "6"
                        font_size: "24sp"
                        background_normal: ""
                        background_color: 0.2, 0.4, 0.6, 0.9
                        color: 1, 1, 1, 1
                        on_release: root.on_key_press("6")
                        canvas.before:
                            Color:
                                rgba: self.background_color
                            RoundedRectangle:
                                pos: self.pos
                                size: self.size
                                radius: [10]

                    # Row 3: 7 8 9
                    Button:
                        text: "7"
                        font_size: "24sp"
                        background_normal: ""
                        background_color: 0.2, 0.4, 0.6, 0.9
                        color: 1, 1, 1, 1
                        on_release: root.on_key_press("7")
                        canvas.before:
                            Color:
                                rgba: self.background_color
                            RoundedRectangle:
                                pos: self.pos
                                size: self.size
                                radius: [10]

                    Button:
                        text: "8"
                        font_size: "24sp"
                        background_normal: ""
                        background_color: 0.2, 0.4, 0.6, 0.9
                        color: 1, 1, 1, 1
                        on_release: root.on_key_press("8")
                        canvas.before:
                            Color:
                                rgba: self.background_color
                            RoundedRectangle:
                                pos: self.pos
                                size: self.size
                                radius: [10]

                    Button:
                        text: "9"
                        font_size: "24sp"
                        background_normal: ""
                        background_color: 0.2, 0.4, 0.6, 0.9
                        color: 1, 1, 1, 1
                        on_release: root.on_key_press("9")
                        canvas.before:
                            Color:
                                rgba: self.background_color
                            RoundedRectangle:
                                pos: self.pos
                                size: self.size
                                radius: [10]

                    # Row 4: Clear 0 Backspace
                    Button:
                        text: "Clear"
                        font_size: "16sp"
                        background_normal: ""
                        background_color: 0.6, 0.3, 0.3, 0.9
                        color: 1, 1, 1, 1
                        on_release: root.clear_employee_code()
                        canvas.before:
                            Color:
                                rgba: self.background_color
                            RoundedRectangle:
                                pos: self.pos
                                size: self.size
                                radius: [10]

                    Button:
                        text: "0"
                        font_size: "24sp"
                        background_normal: ""
                        background_color: 0.2, 0.4, 0.6, 0.9
                        color: 1, 1, 1, 1
                        on_release: root.on_key_press("0")
                        canvas.before:
                            Color:
                                rgba: self.background_color
                            RoundedRectangle:
                                pos: self.pos
                                size: self.size
                                radius: [10]

                    Button:
                        text: "⌫"
                        font_size: "24sp"
                        background_normal: ""
                        background_color: 0.6, 0.4, 0.2, 0.9
                        color: 1, 1, 1, 1
                        on_release: root.on_key_press("⌫")
                        canvas.before:
                            Color:
                                rgba: self.background_color
                            RoundedRectangle:
                                pos: self.pos
                                size: self.size
                                radius: [10]

                # Verify Button
                Button:
                    text: "Verify Face"
                    font_size: "18sp"
                    bold: True
                    size_hint_y: None
                    height: "60dp"
                    background_normal: ""
                    background_color: 0, 0, 0, 0
                    color: 1, 1, 1, 1
                    disabled: not root.employee_code or root.processing
                    on_release: root.verify_employee()

                    canvas.before:
                        Color:
                            rgba: (0.2, 0.6, 0.3, 0.95) if not self.disabled else (0.3, 0.3, 0.3, 0.5)
                        RoundedRectangle:
                            pos: self.pos
                            size: self.size
                            radius: [15]

                Widget:
                    size_hint_y: 0.1

        # ===== Footer =====
        Footer:
            pos_hint: {"y": 0}
            version_text: "Version: 12.9.3"
