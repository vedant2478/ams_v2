fac<FaceAttendanceScreen>:
    name: "face_attendance"

    FloatLayout:

        # ===== Header (CONSTANT) =====
        Header:
            pos_hint: {"top": 1}

        # ===== Back Button (PAGE LEVEL â€“ TRANSPARENT) =====
        BoxLayout:
            orientation: "horizontal"
            size_hint_y: None
            height: "48dp"
            padding: "16dp", 0
            pos_hint: {"top": .95}

            Button:
                text: "Back"
                size_hint_x: None
                width: "100dp"
                background_normal: ""
                background_color: 0, 0, 0, 0   # fully transparent
                color: 0.90, 0.95, 1, 1
                font_size: "16sp"
                on_release: root.go_back()

            Widget:
            
            # Register Button
            Button:
                text: "Register User"
                size_hint_x: None
                width: "150dp"
                background_normal: ""
                background_color: 0.20, 0.42, 0.30, 0.85
                color: 0.90, 0.95, 1, 1
                font_size: "16sp"
                on_release: root.show_registration_popup()

        # ===== Main Content =====
        BoxLayout:
            orientation: "vertical"
            spacing: "20dp"
            size_hint: None, None
            size: "460dp", "540dp"
            pos_hint: {"center_x": 0.5, "center_y": 0.52}

            # ===== Toggle Buttons (In-Time / Out-Time) =====
            BoxLayout:
                orientation: "horizontal"
                size_hint_y: None
                height: "50dp"
                spacing: "10dp"

                ToggleButton:
                    id: in_time_btn
                    text: "In-Time"
                    font_size: "18sp"
                    group: "time_type"
                    state: "down"
                    background_normal: ""
                    background_color: 0, 0, 0, 0
                    color: 0.85, 0.95, 1, 1
                    on_release: root.on_time_type_change("in")

                    canvas.before:
                        Color:
                            rgba: (0.15, 0.30, 0.45, 0.95) if self.state == "down" else (0.18, 0.35, 0.50, 0.6)
                        RoundedRectangle:
                            pos: self.pos
                            size: self.size
                            radius: [25]

                ToggleButton:
                    id: out_time_btn
                    text: "Out-Time"
                    font_size: "18sp"
                    group: "time_type"
                    background_normal: ""
                    background_color: 0, 0, 0, 0
                    color: 0.85, 0.95, 1, 1
                    on_release: root.on_time_type_change("out")

                    canvas.before:
                        Color:
                            rgba: (0.15, 0.30, 0.45, 0.95) if self.state == "down" else (0.18, 0.35, 0.50, 0.6)
                        RoundedRectangle:
                            pos: self.pos
                            size: self.size
                            radius: [25]

            # ===== Camera Feed Display =====
            FloatLayout:
                size_hint_y: None
                height: "340dp"

                canvas.before:
                    Color:
                        rgba: 0.18, 0.35, 0.50, 0.5
                    RoundedRectangle:
                        pos: self.pos
                        size: self.size
                        radius: [20]

                # Camera widget with rounded corners
                KivyCamera:
                    id: camera_feed
                    size_hint: None, None
                    size: "440dp", "320dp"
                    pos_hint: {"center_x": 0.5, "center_y": 0.5}

            # ===== Welcome Message =====
            BoxLayout:
                size_hint_y: None
                height: "60dp"
                padding: "10dp", 0

                canvas.before:
                    Color:
                        rgba: 0.18, 0.35, 0.50, 0.85
                    RoundedRectangle:
                        pos: self.pos
                        size: self.size
                        radius: [30]

                Label:
                    id: welcome_label
                    text: '"USER_NAME" --> Welcome'
                    font_size: "18sp"
                    color: 0.85, 0.95, 1, 1
                    halign: "center"
                    valign: "middle"

        # ===== Footer =====
        Footer:
            pos_hint: {"y": 0}
            version_text: "Version: 12.9.3"
