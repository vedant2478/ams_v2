#:import datetime datetime.datetime

<Header@BoxLayout>:
    orientation: "horizontal"
    size_hint_y: None
    height: "64dp"
    padding: "20dp", "12dp"
    spacing: "15dp"
    
    canvas.before:
        Color:
            rgba: 0.08, 0.12, 0.18, 1
        Rectangle:
            pos: self.pos
            size: self.size
        # Bottom border
        Color:
            rgba: 0.2, 0.4, 0.6, 0.3
        Rectangle:
            pos: self.x, self.y
            size: self.width, 2
    
    # Status Indicator
    BoxLayout:
        size_hint_x: 0.25
        spacing: 8
        
        Widget:
            size_hint_x: None
            width: "12dp"
            canvas:
                Color:
                    rgba: 0, 1, 0, 1
                Ellipse:
                    pos: self.x + 4, self.center_y - 6
                    size: 12, 12
        
        Label:
            text: "System Ready"
            color: 0.7, 1, 0.7, 1
            size_hint_x: None
            width: self.texture_size[0]
            font_size: "15sp"
            halign: "left"
            valign: "middle"
    
    # Device ID
    Label:
        text: "DAKC R0 - 001"
        size_hint_x: 0.5
        font_size: "18sp"
        bold: True
        color: 0.9, 0.95, 1, 1
        halign: "center"
        valign: "middle"
    
    # Time
    Label:
        text: datetime.now().strftime('%H:%M')
        size_hint_x: 0.25
        font_size: "18sp"
        bold: True
        color: 0.85, 0.95, 1, 1
        halign: "right"
        valign: "middle"
        text_size: self.size

<Footer@BoxLayout>:
    version_text: "Version: 12.9.3"
    size_hint_y: None
    height: "44dp"
    padding: "20dp", "10dp"
    
    canvas.before:
        Color:
            rgba: 0.08, 0.12, 0.18, 0.95
        Rectangle:
            pos: self.pos
            size: self.size
        # Top border
        Color:
            rgba: 0.2, 0.4, 0.6, 0.3
        Rectangle:
            pos: self.x, self.top - 2
            size: self.width, 2
    
    Label:
        text: root.version_text
        font_size: "13sp"
        color: 0.6, 0.7, 0.8, 1
        halign: "center"

<FaceAttendanceScreen>:
    name: "face_attendance"

    canvas.before:
        # Gradient background
        Color:
            rgba: 0.05, 0.08, 0.12, 1
        Rectangle:
            pos: self.pos
            size: self.size

    FloatLayout:

        # ===== Header =====
        Header:
            pos_hint: {"top": 1}

        # ===== Navigation Bar =====
        BoxLayout:
            orientation: "horizontal"
            size_hint: 1, None
            height: "60dp"
            padding: "20dp", "6dp"
            spacing: "15dp"
            pos_hint: {"top": .935}

            # Back Button with Icon
            Button:
                text: "‚Üê Back"
                size_hint_x: None
                width: "120dp"
                background_normal: ""
                background_color: 0, 0, 0, 0
                color: 0.85, 0.95, 1, 1
                font_size: "17sp"
                bold: True
                on_release: root.go_back()
                
                canvas.before:
                    Color:
                        rgba: 0.15, 0.25, 0.35, 0.6
                    RoundedRectangle:
                        pos: self.pos
                        size: self.size
                        radius: [12]

            Widget:
            
            # Register Button with modern style
            Button:
                text: "+ Register User"
                size_hint_x: None
                width: "180dp"
                background_normal: ""
                background_color: 0, 0, 0, 0
                color: 1, 1, 1, 1
                font_size: "16sp"
                bold: True
                on_release: root.show_registration_popup()
                
                canvas.before:
                    Color:
                        rgba: 0.15, 0.55, 0.35, 1
                    RoundedRectangle:
                        pos: self.pos
                        size: self.size
                        radius: [12]
                    # Subtle shadow
                    Color:
                        rgba: 0, 0, 0, 0.3
                    RoundedRectangle:
                        pos: self.x + 2, self.y - 2
                        size: self.size
                        radius: [12]

        # ===== Main Content Container =====
        BoxLayout:
            orientation: "vertical"
            spacing: "24dp"
            size_hint: None, None
            size: "520dp", "580dp"
            pos_hint: {"center_x": 0.5, "center_y": 0.48}
            padding: "10dp"

            # ===== Toggle Buttons (Enhanced) =====
            BoxLayout:
                orientation: "horizontal"
                size_hint_y: None
                height: "56dp"
                spacing: "12dp"
                padding: "4dp"
                
                canvas.before:
                    Color:
                        rgba: 0.12, 0.18, 0.25, 0.8
                    RoundedRectangle:
                        pos: self.pos
                        size: self.size
                        radius: [30]

                ToggleButton:
                    id: in_time_btn
                    text: "‚è± In-Time"
                    font_size: "18sp"
                    bold: True
                    group: "time_type"
                    state: "down"
                    background_normal: ""
                    background_color: 0, 0, 0, 0
                    color: (1, 1, 1, 1) if self.state == "down" else (0.7, 0.8, 0.9, 1)
                    on_release: root.on_time_type_change("in")

                    canvas.before:
                        Color:
                            rgba: (0.2, 0.5, 0.8, 1) if self.state == "down" else (0, 0, 0, 0)
                        RoundedRectangle:
                            pos: self.pos
                            size: self.size
                            radius: [26]
                        # Glow effect when active
                        Color:
                            rgba: (0.2, 0.5, 0.8, 0.3) if self.state == "down" else (0, 0, 0, 0)
                        RoundedRectangle:
                            pos: self.x - 2, self.y - 2
                            size: self.width + 4, self.height + 4
                            radius: [28]

                ToggleButton:
                    id: out_time_btn
                    text: "‚è± Out-Time"
                    font_size: "18sp"
                    bold: True
                    group: "time_type"
                    background_normal: ""
                    background_color: 0, 0, 0, 0
                    color: (1, 1, 1, 1) if self.state == "down" else (0.7, 0.8, 0.9, 1)
                    on_release: root.on_time_type_change("out")

                    canvas.before:
                        Color:
                            rgba: (0.8, 0.4, 0.2, 1) if self.state == "down" else (0, 0, 0, 0)
                        RoundedRectangle:
                            pos: self.pos
                            size: self.size
                            radius: [26]
                        # Glow effect when active
                        Color:
                            rgba: (0.8, 0.4, 0.2, 0.3) if self.state == "down" else (0, 0, 0, 0)
                        RoundedRectangle:
                            pos: self.x - 2, self.y - 2
                            size: self.width + 4, self.height + 4
                            radius: [28]

            # ===== Camera Feed Card =====
            FloatLayout:
                size_hint_y: None
                height: "370dp"

                canvas.before:
                    # Outer shadow
                    Color:
                        rgba: 0, 0, 0, 0.4
                    RoundedRectangle:
                        pos: self.x + 4, self.y - 4
                        size: self.size
                        radius: [24]
                    # Card background
                    Color:
                        rgba: 0.12, 0.20, 0.28, 0.95
                    RoundedRectangle:
                        pos: self.pos
                        size: self.size
                        radius: [24]
                    # Inner border
                    Color:
                        rgba: 0.25, 0.45, 0.65, 0.4
                    Line:
                        rounded_rectangle: (self.x, self.y, self.width, self.height, 24)
                        width: 1.5

                # Camera Title
                Label:
                    text: "üìπ Live Camera Feed"
                    size_hint: None, None
                    size: 200, 30
                    pos_hint: {"center_x": 0.5, "top": 0.98}
                    font_size: "16sp"
                    bold: True
                    color: 0.7, 0.85, 1, 1

                # Camera Display
                KivyCamera:
                    id: camera_feed
                    size_hint: None, None
                    size: "480dp", "310dp"
                    pos_hint: {"center_x": 0.5, "center_y": 0.48}
                    
                    canvas.before:
                        Color:
                            rgba: 0.08, 0.12, 0.18, 1
                        RoundedRectangle:
                            pos: self.pos
                            size: self.size
                            radius: [16]

            # ===== Welcome Message Card =====
            BoxLayout:
                size_hint_y: None
                height: "70dp"
                padding: "20dp", "0dp"

                canvas.before:
                    # Shadow
                    Color:
                        rgba: 0, 0, 0, 0.3
                    RoundedRectangle:
                        pos: self.x + 3, self.y - 3
                        size: self.size
                        radius: [35]
                    # Gradient background
                    Color:
                        rgba: 0.18, 0.42, 0.65, 1
                    RoundedRectangle:
                        pos: self.pos
                        size: self.size
                        radius: [35]
                    # Highlight
                    Color:
                        rgba: 1, 1, 1, 0.1
                    RoundedRectangle:
                        pos: self.x, self.top - 35
                        size: self.width, 35
                        radius: [35, 35, 0, 0]

                # Icon
                Label:
                    text: "üë§"
                    font_size: "32sp"
                    size_hint_x: None
                    width: "50dp"

                # Welcome Text
                Label:
                    id: welcome_label
                    text: '"USER_NAME" ‚Üí Welcome!'
                    font_size: "20sp"
                    bold: True
                    color: 1, 1, 1, 1
                    halign: "center"
                    valign: "middle"

        # ===== Status Indicator =====
        Label:
            id: status_indicator
            text: ""
            size_hint: None, None
            size: 200, 30
            pos_hint: {"center_x": 0.5, "y": 0.08}
            font_size: "14sp"
            color: 0.5, 0.8, 0.5, 1
            halign: "center"

        # ===== Footer =====
        Footer:
            pos_hint: {"y": 0}
            version_text: "Version: 12.9.3"
