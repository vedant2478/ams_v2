#:kivy 2.1.0

<KeyDashboardScreen>:
    BoxLayout:
        orientation: "vertical"

        Header:
            size_hint_y: None
            height: dp(64)

        BoxLayout:
            size_hint_y: None
            height: dp(48)
            padding: dp(16), 0

            Button:
                text: "Back"
                size_hint_x: None
                width: dp(100)
                background_color: 0,0,0,0
                on_release: root.go_back()

            Widget:

        BoxLayout:
            size_hint_y: 1
            padding: dp(24)

            GradientBackground:
                pos: self.pos
                size: self.size

            BoxLayout:
                orientation: "vertical"
                spacing: dp(16)

                Label:
                    text: "KEY AUTHORIZATION\nDASHBOARD"
                    font_size: "24sp"
                    bold: True
                    size_hint_y: None
                    height: self.texture_size[1] + dp(12)
                    text_size: self.width, None
                    halign: "center"
                    valign: "middle"

                BoxLayout:
                    size_hint_y: None
                    height: dp(56)
                    spacing: dp(12)

                    Label:
                        text: "ACTIVITY CODE: " + root.activity_code
                        bold: True

                    Label:
                        text: "Time: " + root.time_remaining + " sec"
                        halign: "right"

                BoxLayout:
                    orientation: "vertical"
                    size_hint_y: 1
                    padding: dp(12)

                    ScrollView:
                        do_scroll_x: False

                        GridLayout:
                            id: key_grid
                            cols: 1
                            spacing: dp(8)
                            size_hint_y: None
                            height: self.minimum_height
                            row_default_height: dp(56)
                            row_force_default: True

        Footer:
            size_hint_y: None
            height: dp(48)

    # LOADING OVERLAY
    FloatLayout:
        opacity: 1 if root.is_loading else 0
        disabled: not root.is_loading

        BoxLayout:
            size_hint: None, None
            size: dp(300), dp(120)
            pos_hint: {"center_x":0.5,"center_y":0.5}
            orientation: "vertical"
            spacing: dp(10)
            padding: dp(16)

            canvas.before:
                Color:
                    rgba: 0,0,0,0.7
                RoundedRectangle:
                    radius: [18]
                    pos: self.pos
                    size: self.size

            Label:
                text: "Initializing Hardware..."
                font_size: "16sp"
                halign: "center"

            Label:
                text: "Please wait"
                font_size: "14sp"


<KeyItem>:
    size_hint_y: None
    height: dp(56)
    padding: dp(16), 0

    canvas.before:
        Color:
            rgba: 0.05, 0.12, 0.24, 1
        RoundedRectangle:
            radius: [14]
            pos: self.pos
            size: self.size

    Label:
        text: root.key_name
        size_hint_x: 0.7

    BoxLayout:
        size_hint_x: 0.3
        spacing: dp(8)

        Widget:
            canvas:
                Color:
                    rgba: root.status_color
                Ellipse:
                    size: dp(16), dp(16)
                    pos: self.center_x - dp(8), self.center_y - dp(8)

        Label:
            text: root.status
            color: root.status_color
