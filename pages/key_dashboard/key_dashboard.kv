#:kivy 2.1.0

<KeyDashboardScreen>:
    FloatLayout:

        # ================= MAIN UI =================
        BoxLayout:
            orientation: "vertical"
            size_hint: 1, 1

            Header:
                size_hint_y: None
                height: dp(64)

            BoxLayout:
                size_hint_y: None
                height: dp(48)
                padding: dp(16), 0

                Button:
                    text: "Back"
                    size_hint_x: None
                    width: dp(100)
                    background_normal: ""
                    background_color: 0,0,0,0
                    on_release: root.go_back()

                Widget:

            BoxLayout:
                orientation: "vertical"
                padding: dp(20)
                spacing: dp(10)

                Label:
                    text: "KEY AUTHORIZATION DASHBOARD"
                    font_size: "24sp"
                    size_hint_y: None
                    height: self.texture_size[1] + dp(10)

                ScrollView:
                    GridLayout:
                        id: key_grid
                        cols: 1
                        spacing: dp(8)
                        padding: dp(8)
                        size_hint_y: None
                        height: self.minimum_height
                        row_force_default: True
                        row_default_height: dp(56)

            Footer:
                size_hint_y: None
                height: dp(48)

        # ================= LOADING OVERLAY =================
        FloatLayout:
            opacity: 1 if root.is_loading else 0
            disabled: not root.is_loading

            canvas.before:
                Color:
                    rgba: 0, 0, 0, 0.65
                Rectangle:
                    pos: self.pos
                    size: self.size

            Label:
                text: "Initializing Hardware..."
                font_size: "20sp"
                pos_hint: {"center_x": 0.5, "center_y": 0.5}


<KeyItem>:
    size_hint_y: None
    height: dp(56)
    padding: dp(16), 0
    spacing: dp(10)

    canvas.before:
        Color:
            rgba: 0.05, 0.12, 0.24, 1
        RoundedRectangle:
            radius: [14]
            pos: self.pos
            size: self.size

    Label:
        text: root.key_name
        font_size: "16sp"
        halign: "left"
        valign: "middle"
        text_size: self.size

    BoxLayout:
        size_hint_x: None
        width: dp(110)
        spacing: dp(8)

        Widget:
            size_hint_x: None
            width: dp(18)
            canvas:
                Color:
                    rgba: root.status_color
                Ellipse:
                    pos: self.center_x - dp(8), self.center_y - dp(8)
                    size: dp(16), dp(16)

        Label:
            text: root.status
            color: root.status_color
            font_size: "14sp"
            valign: "middle"
